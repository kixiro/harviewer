define("preview/ref",["core/lib"],function(e){var t={resolveJson:function(t,r){function i(v,h,u,_,g){var m,$,b=o in v?v[o]:u;void 0!==b&&(b=(a+b).replace(p,"$2$3"));var A=g||v;if(void 0!==b){if(f&&(v.__id=b),!r.schemas||v instanceof Array||!($=b.match(/^(.+\/)[^\.\[]*$/))||(_=r.schemas[$[1]]),s[b]&&v instanceof Array==s[b]instanceof Array)A=s[b],delete A.$ref,m=!0;else{var O=_&&_.prototype;O&&(y.prototype=O,A=new y)}s[b]=A,c&&(c[b]=r.time)}var j=_&&_.properties,w=v.length;for(var P in v){if(P==w)break;if(v.hasOwnProperty(P)){$=v[P];var D=j&&j[P];if(D&&"date-time"==D.format&&"string"==typeof $)$=e.fromISOString($);else if("object"==typeof $&&$&&!($ instanceof Date))if(n=$.$ref){delete v[P];var S=n.replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/);if((n="$"==S[1]||"this"==S[1]||""==S[1]?t:s[(a+S[1]).replace(p,"$2$3")])&&S[3]&&S[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(e,t,r,i,o){n=n&&n[r?r.replace(/[\"\'\\]/,""):o]}),n)$=n;else if(h)$=i($,!1,$.$ref,D),$._loadObject=r.loader;else{var I;I||d.push(A),I=!0}}else h||($=i($,d==v,b&&l(b,P),D,A!=v&&"object"==typeof A[P]&&A[P]));if(v[P]=$,A!=v&&!A.__isDirty){var U=A[P];A[P]=$,!m||$===U||A._loadObject||$ instanceof Date&&U instanceof Date&&$.getTime()==U.getTime()||"function"==typeof $&&"function"==typeof U&&$.toString()==U.toString()||!s.onUpdate||s.onUpdate(A,P,U,$)}}}if(m){for(P in A)if(!A.__isDirty&&A.hasOwnProperty(P)&&!v.hasOwnProperty(P)&&"__id"!=P&&"__clientId"!=P&&!(A instanceof Array&&isNaN(P)))for(s.onUpdate&&"_loadObject"!=P&&"_idAttr"!=P&&s.onUpdate(A,P,A[P],void 0),delete A[P];A instanceof Array&&A.length&&void 0===A[A.length-1];)A.length--}else s.onLoad&&s.onLoad(A);return A}r=r||{};var n,o=r.idAttribute||"id",a=r.idPrefix||"",f=r.assignAbsoluteIds,s=r.index||{},c=r.timeStamps,d=[],p=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,l=this._addProp,y=function(){};return t&&"object"==typeof t&&(t=i(t,!1,r.defaultId),i(d,!1)),t},_addProp:function(e,t){return e+(e.match(/#/)?1==e.length?"":".":"#")+t}};return t});