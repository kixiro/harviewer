/* See license.txt for terms of usage */

define("tabs/homeTab",["domplate/domplate","domplate/tabView","core/lib","core/cookies","core/trace","i18n!nls/homeTab","text!tabs/homeTab.html","preview/harModel"],function(e,t,i,n,o,a,r,d){function l(){}var c=e.DIV;return l.prototype=i.extend(t.Tab.prototype,{id:"Home",label:a.homeTabLabel,bodyTag:c({"class":"homeBody"}),onUpdateBody:function(e,t){t=this.bodyTag.replace({},t),t.innerHTML=r.replace("@HAR_SPEC_URL@",e.harSpecURL,"g"),$("#appendPreview").click(i.bindFixed(this.onAppendPreview,this)),$(".linkAbout").click(i.bind(this.onAbout,this));var o=$("#content");o.bind("dragenter",i.bind(i.cancelEvent,i)),o.bind("dragover",i.bind(i.cancelEvent,i)),o.bind("drop",i.bind(this.onDrop,this)),this.validateNode=$("#validate");var a=n.getCookie("validate");a&&this.validateNode.prop("checked","false"===a?!1:!0),this.validateNode.change(i.bind(this.onValidationChange,this)),$(".example").click(i.bind(this.onLoadExample,this))},onAppendPreview:function(e){e||(e=$("#sourceEditor").val()),e&&this.tabView.appendPreview(e)},onAbout:function(){this.tabView.selectTabByName("About")},onValidationChange:function(){var e=this.validateNode.prop("checked");n.setCookie("validate",e)},onLoadExample:function(e){var t=i.fixEvent(e),o=t.target.getAttribute("har"),a=document.location.href,r=a.indexOf("?");document.location=a.substr(0,r)+"?har="+o,n.setCookie("timeline",!0),n.setCookie("stats",!0)},onDrop:function(e){var t=i.fixEvent(e);i.cancelEvent(t);try{this.handleDrop(e.originalEvent.dataTransfer)}catch(n){o.exception("HomeTab.onDrop EXCEPTION",n)}},handleDrop:function(e){if(!e)return!1;var t=e.files;if(t)for(var n=0;n<t.length;n++){var o=t[n],a=i.getFileExtension(o.name);if("har"===a.toLowerCase()){var r=this,d=this.getFileReader(o,function(e){e&&r.onAppendPreview(e)});d()}}},getFileReader:function(e,t){return function i(){if("undefined"!=typeof e.getAsText)return void t(e.getAsText(""));if("undefined"!=typeof FileReader){var i=new FileReader;i.onloadend=function(){t(i.result)},i.readAsText(e)}}},loadInProgress:function(e,t){$("#sourceEditor").val(e?t?t:a.loadingHar:"")}}),l});