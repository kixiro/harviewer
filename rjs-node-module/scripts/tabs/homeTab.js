/* See license.txt for terms of usage */

define("tabs/homeTab",["domplate/domplate","domplate/tabView","core/lib","core/cookies","core/trace","i18n!nls/homeTab","text!tabs/homeTab.html","preview/harModel"],function(e,t,n,i,o,a,r,d){function l(){}var c=e.DIV;return l.prototype=n.extend(t.Tab.prototype,{id:"Home",label:a.homeTabLabel,bodyTag:c({class:"homeBody"}),onUpdateBody:function(e,t){t=this.bodyTag.replace({},t),t.innerHTML=r.replace("@HAR_SPEC_URL@",e.harSpecURL,"g"),$("#appendPreview").click(n.bindFixed(this.onAppendPreview,this)),$(".linkAbout").click(n.bind(this.onAbout,this));var o=$("#content");o.bind("dragenter",n.bind(n.cancelEvent,n)),o.bind("dragover",n.bind(n.cancelEvent,n)),o.bind("drop",n.bind(this.onDrop,this)),this.validateNode=$("#validate");var a=i.getCookie("validate");a&&this.validateNode.prop("checked","false"!==a),this.validateNode.change(n.bind(this.onValidationChange,this)),$(".example").click(n.bind(this.onLoadExample,this))},onAppendPreview:function(e){e||(e=$("#sourceEditor").val()),e&&this.tabView.appendPreview(e)},onAbout:function(){this.tabView.selectTabByName("About")},onValidationChange:function(){var e=this.validateNode.prop("checked");i.setCookie("validate",e)},onLoadExample:function(e){var t=n.fixEvent(e),o=t.target.getAttribute("har"),a=document.location.href,r=a.indexOf("?");document.location=a.substr(0,r)+"?har="+o,i.setCookie("timeline",!0),i.setCookie("stats",!0)},onDrop:function(e){var t=n.fixEvent(e);n.cancelEvent(t);try{this.handleDrop(e.originalEvent.dataTransfer)}catch(e){o.exception("HomeTab.onDrop EXCEPTION",e)}},handleDrop:function(e){function t(e,n){if(n=n||0,!(n>=e.length)){var i=r.getFileReader(e[n],function(i){i&&r.onAppendPreview(i),t(e,n+1)});i()}}if(!e)return!1;var i=e.files;if(i){var o=[].slice.call(i),a=o.filter(function(e){var t=n.getFileExtension(e.name);return"har"===t.toLowerCase()});a.sort(function(e,t){return e.name.localeCompare(t.name)});var r=this;t(a)}},getFileReader:function(e,t){return function n(){if("undefined"!=typeof e.getAsText)return void t(e.getAsText(""));if("undefined"!=typeof FileReader){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsText(e)}}},loadInProgress:function(e,t){$("#sourceEditor").val(e?t?t:a.loadingHar:"")}}),l});