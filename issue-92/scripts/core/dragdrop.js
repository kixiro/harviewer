/* See license.txt for terms of usage */

define(["./object","./events"],function(t,s){function n(n,i){this.element=n,this.handle=n,this.callbacks=i,this.cursorStartPos=null,this.cursorLastPos=null,this.dragging=!1,this.onDragStart=t.bind(this.onDragStart,this),this.onDragOver=t.bind(this.onDragOver,this),this.onDrop=t.bind(this.onDrop,this),s.addEventListener(this.element,"mousedown",this.onDragStart,!1),this.active=!0}function i(t,s){this.x=t,this.y=s,this.Add=function(t){var s=new i(this.x,this.y);return null!==t&&void 0!==t&&(isNaN(t.x)||(s.x+=t.x),isNaN(t.y)||(s.y+=t.y)),s},this.Subtract=function(t){var s=new i(this.x,this.y);return null!==t&&void 0!==t&&(isNaN(t.x)||(s.x-=t.x),isNaN(t.y)||(s.y-=t.y)),s},this.Bound=function(t,s){var n=this.Max(t);return n.Min(s)},this.Check=function(){var t=new i(this.x,this.y);return isNaN(t.x)&&(t.x=0),isNaN(t.y)&&(t.y=0),t},this.Apply=function(t){"string"==typeof t&&(t=document.getElementById(t)),t&&(isNaN(this.x)||(t.style.left=this.x+"px"),isNaN(this.y)||(t.style.top=this.y+"px"))}}function e(t){return isNaN(window.scrollX)?new i(t.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,t.clientY+document.documentElement.scrollTop+document.body.scrollTop):new i(t.clientX+window.scrollX,t.clientY+window.scrollY)}var r={onDragStart:function(t){var n=s.fixEvent(t);this.dragging||(this.callbacks.onDragStart&&this.callbacks.onDragStart(this),this.dragging=!0,this.cursorStartPos=e(n),this.cursorLastPos=this.cursorStartPos,s.addEventListener(this.element.ownerDocument,"mousemove",this.onDragOver,!1),s.addEventListener(this.element.ownerDocument,"mouseup",this.onDrop,!1),s.cancelEvent(n))},onDragOver:function(t){if(this.dragging){var n=s.fixEvent(t);s.cancelEvent(n);var i=e(n);i=i.Subtract(this.cursorStartPos),this.cursorLastPos.x===i.x&&this.cursorLastPos.y===i.y||"function"==typeof this.callbacks.onDragOver&&(this.callbacks.onDragOver(i,this),this.cursorLastPos=i)}},onDrop:function(t){if(this.dragging){var n=s.fixEvent(t);s.cancelEvent(n),this.dragStop()}},dragStop:function(){this.dragging&&(s.removeEventListener(this.element.ownerDocument,"mousemove",this.onDragOver,!1),s.removeEventListener(this.element.ownerDocument,"mouseup",this.onDrop,!1),this.cursorStartPos=null,this.cursorLastPos=null,null!==this.callbacks.onDrop&&this.callbacks.onDrop(this),this.dragging=!1)},destroy:function(){s.removeEventListener(this.element,"mousedown",this.onDragStart,!1),this.active=!1,this.dragging&&this.dragStop()}};n.prototype=r;var o={};return o.Tracker=n,o});