/* See license.txt for terms of usage */

define("domplate/tabView",["domplate/domplate","core/lib","core/trace"],function(e,t,a){function s(e){this.id=e,this.tabs=[],this.listeners=[],this.tabBarVisibility=!0}var i=e.domplate,b=e.A,d=e.DIV,r=e.TABLE,l=e.TAG,o=e.TBODY,n=e.TD,c=e.TR,h=i({tag:r({class:"tabView",cellpadding:0,cellspacing:0,_repObject:"$tabView"},o(c({class:"tabViewRow"},n({class:"tabViewCol",valign:"top"},l("$tabList",{tabView:"$tabView"}))))),tabList:d({class:"tabViewBody",onclick:"$onClickTab"},d({class:"$tabView.id\\Bar tabBar"}),d({class:"$tabView.id\\Bodies tabBodies"})),tabHeaderTag:b({class:"$tab.id\\Tab tab",title:"$tab|getTitle",view:"$tab.id",_repObject:"$tab"},"$tab.label"),tabBodyTag:d({class:"tab$tab.id\\Body tabBody",_repObject:"$tab"}),hideTab:function(e){return!1},onClickTab:function(e){var a=t.fixEvent(e),s=this.getTabView(a.target);s.onClickTab(a)},getTabView:function(e){var a=t.getAncestorByClass(e,"tabView");return a.repObject},getTitle:function(e){return e.title||""}});return s.prototype={appendTab:function(e){return this.tabs.push(e),e.tabView=this,e},removeTab:function(e){for(var t=0;t<this.tabs.length;t++){var a=this.tabs[t];if(a.id===e){this.tabs.splice(t,1);break}}},getTab:function(e){for(var t=0;t<this.tabs.length;t++){var a=this.tabs[t];if(a.id===e)return a}},selectTabByName:function(e){var a=t.getElementByClass(this.element,e+"Tab");a&&this.selectTab(a)},showTabBar:function(e){this.element?e?this.element.removeAttribute("hideTabBar"):this.element.setAttribute("hideTabBar","true"):this.tabBarVisibility=e},addListener:function(e){this.listeners.push(e)},removeListener:function(e){t.remove(this.listeners,e)},onClickTab:function(e){var a=t.getAncestorByClass(e.target,"tab");a&&this.selectTab(a)},selectTab:function(e){if(t.hasClass(e,"tab")&&(!t.hasClass(e,"selected")||!e._updated)){var s=e.getAttribute("view");if(s){var i=t.getAncestorByClass(e,"tabViewBody");i.selectedTab&&(i.selectedTab.removeAttribute("selected"),i.selectedBody.removeAttribute("selected"),t.removeClass(i.selectedTab,"selected"),t.removeClass(i.selectedBody,"selected"));var b=t.getElementByClass(i,"tab"+s+"Body");b||a.error("TabView.selectTab; Missing tab body",e),i.selectedTab=e,i.selectedBody=b,i.selectedTab.setAttribute("selected","true"),i.selectedBody.setAttribute("selected","true"),t.setClass(i.selectedBody,"selected"),t.setClass(i.selectedTab,"selected"),this.updateTabBody(i,s)}}},updateTabBody:function(e,t){var a=e.selectedTab.repObject;if(!a._body._updated){a._body._updated=!0,a.bodyTag&&a.bodyTag.replace({tab:a},a._body),a&&a.onUpdateBody&&a.onUpdateBody(this,a._body);for(var s=0;s<this.listeners.length;s++){var i=this.listeners[s];i.onUpdateBody&&i.onUpdateBody(this,a._body)}}},render:function(e){this.element=h.tag.replace({tabView:this},e,h),t.setClass(this.element,this.id),this.showTabBar(this.tabBarVisibility);for(var s=0;s<this.tabs.length;s++){var i=this.tabs[s],b=i.tabHeaderTag?i.tabHeaderTag:h.tabHeaderTag,d=i.tabBodyTag?i.tabBodyTag:h.tabBodyTag;try{i._header=b.append({tab:i},t.$(e,"tabBar")),i._body=d.append({tab:i},t.$(e,"tabBodies"))}catch(e){a.exception("TabView.appendTab; Exception ",e)}}return this.element}},s.Tab=function(){},s.Tab.prototype={invalidate:function(){this._updated=!1},select:function(){this.tabView.selectTabByName(this.id)}},s});